# üîç Debug Guide - Sistema de Estoque

## ‚úÖ Status Atual
- Backend: ‚úÖ Rodando na porta 3000
- Dados: ‚úÖ 40 itens carregados no banco
- API: ‚úÖ Testada e funcional
- Frontend: ‚è≥ Aguardando teste

## üöÄ Checklist R√°pido

### 1. Backend est√° rodando?
```powershell
# Teste o ping
Invoke-WebRequest -Uri "http://localhost:3000/api/ping"
```
**Resposta esperada**: `{"pong":true,"ts":"..."}`

### 2. Dados est√£o no banco?
```powershell
# Verificar quantidade de itens
$resp = Invoke-WebRequest -Uri "http://localhost:3000/api/estoque"
$data = $resp.Content | ConvertFrom-Json
Write-Host "Itens no estoque: $($data.Length)"
```
**Resposta esperada**: `Itens no estoque: 40`

### 3. Frontend compilando?
```powershell
cd Frontend
npm run dev
```
**Erro comum**: "Port 5173 is already in use"
**Solu√ß√£o**: Feche outros processos ou use porta alternativa

### 4. Navegador mostrando dados?

#### Abra o Console (F12)
Procure por erros no console do navegador.

**Erros comuns:**

‚ùå **`Failed to fetch`**
- Causa: Backend n√£o est√° rodando
- Solu√ß√£o: `cd back-end && npm run dev`

‚ùå **`CORS error`**
- Causa: CORS n√£o configurado
- Solu√ß√£o: J√° configurado no index.ts, reinicie o backend

‚ùå **`Cannot read property 'map' of undefined`**
- Causa: Dados n√£o chegaram do backend
- Solu√ß√£o: Verifique se API retorna array

#### Teste direto no navegador
Abra: http://localhost:3000/api/estoque

**Deve mostrar**: JSON com 40 itens

### 5. Componente carregando?

Adicione logs tempor√°rios no `estoque-management.tsx`:

```typescript
useEffect(() => {
  console.log('üîÑ Carregando dados do estoque...');
  carregarDados();
}, [filtroAtivos, filtroAbaixoMinimo]);

const carregarDados = async () => {
  try {
    console.log('üì° Chamando API...');
    setLoading(true);
    
    const params: any = {};
    if (filtroAtivos) params.ativos = "true";
    if (filtroAbaixoMinimo) params.abaixo_minimo = "true";
    
    const estoqueData = await Processador.sendGet("estoque", params);
    console.log('‚úÖ Dados recebidos:', estoqueData.length, 'itens');
    
    setEstoques(estoqueData);
    // ... resto do c√≥digo
  } catch (error) {
    console.error('‚ùå Erro ao carregar:', error);
  }
};
```

### 6. Testar APIs Individualmente

#### Estoque
```powershell
Invoke-WebRequest -Uri "http://localhost:3000/api/estoque" | Select-Object -ExpandProperty Content | ConvertFrom-Json | Select-Object -First 3
```

#### Estat√≠sticas
```powershell
Invoke-WebRequest -Uri "http://localhost:3000/api/estoque/estatisticas" | Select-Object -ExpandProperty Content
```

#### Proje√ß√µes
```powershell
Invoke-WebRequest -Uri "http://localhost:3000/api/estoque/projecao" | Select-Object -ExpandProperty Content | ConvertFrom-Json | Select-Object -First 3
```

#### Consumo
```powershell
Invoke-WebRequest -Uri "http://localhost:3000/api/estoque/consumo" | Select-Object -ExpandProperty Content | ConvertFrom-Json | Select-Object -First 3
```

### 7. Verificar Erros no Backend

Veja o terminal onde rodou `npm run dev`:

**Procure por:**
- ‚ùå `Error` ou `TypeError`
- ‚ö†Ô∏è `Warning`
- ‚úÖ `[Server] API server running on port 3000`

### 8. Testar Rota Espec√≠fica

```powershell
# Ver primeiro item do estoque
$resp = Invoke-WebRequest -Uri "http://localhost:3000/api/estoque"
$data = $resp.Content | ConvertFrom-Json
$data[0] | ConvertTo-Json -Depth 3
```

**Deve retornar algo como:**
```json
{
  "id": "uuid-here",
  "materia_prima_id": "uuid-here",
  "quantidade": 468000,
  "quantidade_minima": 54600,
  "quantidade_maxima": 702000,
  "unidade": "kg",
  "ativo": true,
  "materia_prima": {
    "id": "uuid",
    "produto": "MP1",
    "num": 1
  }
}
```

## üêõ Problemas Conhecidos

### 1. "Cannot find module Processador"
**Causa**: Import incorreto
**Solu√ß√£o**: Use `import { getProcessador } from "./Processador"`

### 2. Gr√°ficos n√£o aparecem
**Causa**: Recharts n√£o instalado ou dados vazios
**Solu√ß√£o**: 
```powershell
cd Frontend
npm install recharts
```

### 3. Componentes UI faltando
**Causa**: shadcn/ui n√£o configurado
**Solu√ß√£o**: J√° configurado, mas verifique:
```powershell
ls Frontend/src/components/ui/
```

### 4. Dados n√£o atualizam
**Causa**: Cache ou useEffect n√£o disparando
**Solu√ß√£o**: Hard refresh (Ctrl+Shift+R)

### 5. Loading infinito
**Causa**: API n√£o respondendo ou erro silencioso
**Solu√ß√£o**: Veja console do navegador (F12)

## üìä Exemplo de Resposta Esperada

### GET /api/estoque
```json
[
  {
    "id": "cb8ab938-78c1-4a4c-8538-87fdd390e68e",
    "materia_prima_id": "cb8ab938-78c1-4a4c-8538-87fdd390e68e",
    "quantidade": 468000,
    "quantidade_minima": 54600,
    "quantidade_maxima": 702000,
    "unidade": "kg",
    "ativo": true,
    "materia_prima": {
      "id": "cb8ab938-78c1-4a4c-8538-87fdd390e68e",
      "num": 1,
      "produto": "MP1",
      "medida": 1
    }
  }
]
```

### GET /api/estoque/estatisticas
```json
{
  "totalItens": 40,
  "itensAbaixoMinimo": 0,
  "itensAcimaMaximo": 0,
  "valorTotalEstoque": 0,
  "taxaRotacao": 0.25
}
```

## ‚úÖ Checklist Final

- [ ] Backend rodando na porta 3000
- [ ] Teste API: http://localhost:3000/api/estoque retorna 40 itens
- [ ] Frontend compilando sem erros
- [ ] Navegador acessa: http://localhost:5173
- [ ] Rota /estoque-management existe no menu
- [ ] Console do navegador sem erros
- [ ] Dados aparecem na interface

## üÜò Ainda com problema?

1. **Reinicie tudo**:
   ```powershell
   # Terminal 1
   cd back-end
   npm run dev
   
   # Terminal 2
   cd Frontend
   npm run dev
   ```

2. **Limpe cache**:
   ```powershell
   # Backend
   cd back-end
   Remove-Item cache.sqlite -Force
   
   # Frontend
   cd Frontend
   Remove-Item -Recurse -Force dist, node_modules/.vite
   ```

3. **Regenere dados**:
   ```powershell
   cd back-end
   node init-estoque-real.js
   ```

4. **Verifique portas**:
   ```powershell
   netstat -ano | findstr :3000
   netstat -ano | findstr :5173
   ```

## üìù Log de A√ß√µes

Execute e compartilhe este log se continuar com problemas:

```powershell
Write-Host "=== DIAGN√ìSTICO DO SISTEMA DE ESTOQUE ===" -ForegroundColor Cyan

Write-Host "`n1. Testando Backend..." -ForegroundColor Yellow
try {
    $ping = Invoke-WebRequest -Uri "http://localhost:3000/api/ping" -ErrorAction Stop
    Write-Host "‚úÖ Backend respondendo" -ForegroundColor Green
} catch {
    Write-Host "‚ùå Backend n√£o responde: $_" -ForegroundColor Red
}

Write-Host "`n2. Verificando Estoque..." -ForegroundColor Yellow
try {
    $estoque = Invoke-WebRequest -Uri "http://localhost:3000/api/estoque" -ErrorAction Stop
    $data = $estoque.Content | ConvertFrom-Json
    Write-Host "‚úÖ Estoque: $($data.Length) itens" -ForegroundColor Green
} catch {
    Write-Host "‚ùå Erro ao buscar estoque: $_" -ForegroundColor Red
}

Write-Host "`n3. Verificando Estat√≠sticas..." -ForegroundColor Yellow
try {
    $stats = Invoke-WebRequest -Uri "http://localhost:3000/api/estoque/estatisticas" -ErrorAction Stop
    Write-Host "‚úÖ Estat√≠sticas dispon√≠veis" -ForegroundColor Green
    Write-Host $stats.Content
} catch {
    Write-Host "‚ùå Erro nas estat√≠sticas: $_" -ForegroundColor Red
}

Write-Host "`n4. Verificando Frontend..." -ForegroundColor Yellow
if (Test-Path "Frontend/src/estoque-management.tsx") {
    Write-Host "‚úÖ Componente existe" -ForegroundColor Green
} else {
    Write-Host "‚ùå Componente n√£o encontrado" -ForegroundColor Red
}

Write-Host "`n=== FIM DO DIAGN√ìSTICO ===" -ForegroundColor Cyan
```

Salve a sa√≠da e compartilhe se precisar de ajuda adicional.
