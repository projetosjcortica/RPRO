/**
 * Script de teste para verificar as rotas de estoque
 * Execute: node test-estoque-api.js
 */

const BASE_URL = 'http://localhost:3000';

async function testarRotas() {
  console.log('üß™ Testando rotas de estoque...\n');

  try {
    // 1. Verificar servidor
    console.log('1Ô∏è‚É£ Verificando servidor...');
    const pingRes = await fetch(`${BASE_URL}/api/ping`);
    const pingData = await pingRes.json();
    console.log('‚úÖ Servidor respondendo:', pingData);

    // 2. Listar estoque atual
    console.log('\n2Ô∏è‚É£ Listando estoque atual...');
    const estoqueRes = await fetch(`${BASE_URL}/api/estoque`);
    const estoqueData = await estoqueRes.json();
    console.log(`‚úÖ ${estoqueData.length} itens em estoque`);

    // 3. Gerar dados de exemplo (se estoque vazio)
    if (estoqueData.length === 0) {
      console.log('\n3Ô∏è‚É£ Estoque vazio. Gerando dados de exemplo...');
      const exemploRes = await fetch(`${BASE_URL}/api/estoque/gerar-dados-exemplo`, {
        method: 'POST'
      });
      const exemploData = await exemploRes.json();
      console.log('‚úÖ Dados de exemplo gerados:', exemploData);
      
      // Recarregar estoque
      const novoEstoqueRes = await fetch(`${BASE_URL}/api/estoque`);
      const novoEstoqueData = await novoEstoqueRes.json();
      console.log(`‚úÖ ${novoEstoqueData.length} itens agora dispon√≠veis`);
    }

    // 4. Buscar estat√≠sticas
    console.log('\n4Ô∏è‚É£ Buscando estat√≠sticas...');
    const estatRes = await fetch(`${BASE_URL}/api/estoque/estatisticas`);
    const estatData = await estatRes.json();
    console.log('‚úÖ Estat√≠sticas:', estatData);

    // 5. Buscar proje√ß√µes
    console.log('\n5Ô∏è‚É£ Buscando proje√ß√µes de estoque...');
    const projecaoRes = await fetch(`${BASE_URL}/api/estoque/projecao?dias=30`);
    const projecaoData = await projecaoRes.json();
    console.log(`‚úÖ ${projecaoData.length} proje√ß√µes calculadas`);
    if (projecaoData.length > 0) {
      console.log('   Exemplo:', projecaoData[0]);
    }

    // 6. Buscar consumo
    console.log('\n6Ô∏è‚É£ Calculando consumo de mat√©rias-primas...');
    const consumoRes = await fetch(`${BASE_URL}/api/estoque/consumo`);
    const consumoData = await consumoRes.json();
    console.log(`‚úÖ ${consumoData.length} itens com consumo calculado`);
    if (consumoData.length > 0) {
      console.log('   Exemplo:', consumoData[0]);
    }

    // 7. Listar movimenta√ß√µes
    console.log('\n7Ô∏è‚É£ Listando movimenta√ß√µes...');
    const movRes = await fetch(`${BASE_URL}/api/estoque/movimentacoes`);
    const movData = await movRes.json();
    console.log(`‚úÖ ${movData.length} movimenta√ß√µes registradas`);

    console.log('\n‚úÖ Todos os testes conclu√≠dos com sucesso!');
    console.log('\nüìä Acesse o frontend em: http://localhost:5173/estoque-management');

  } catch (error) {
    console.error('\n‚ùå Erro durante os testes:', error.message);
    console.error('\nüí° Certifique-se de que o backend est√° rodando: npm run dev');
  }
}

// Executar testes
testarRotas();
